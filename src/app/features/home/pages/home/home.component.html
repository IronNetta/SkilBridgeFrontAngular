<section class="home">

  @if (!isLoggedIn()) {
    <div class="hero">
      <app-theme-toggle></app-theme-toggle>
      <h1>Trouvez le mentor id√©al</h1>
      <p>
        SkillBridge connecte les √©tudiants avec des experts pour apprendre plus vite.
      </p>
      <div class="cta">
        <button
          pButton
          label="Se connecter"
          class="p-button-rounded p-button-lg p-button-primary me-3"
          (click)="showLogin()"
        ></button>
      </div>
    </div>

    <p-dialog
      header="Connexion / Inscription"
      [(visible)]="loginVisible"
      [style]="{ width: '30rem', height: '35rem' }"
    >
      <app-login-register-card (close)="closeLogin()"></app-login-register-card>
    </p-dialog>

    <div class="features">
      <p-card>
        <ng-template pTemplate="header">
          <img src="assets/img/target.png" alt="Apprentissage cibl√©" width="100" />
        </ng-template>
        <ng-template pTemplate="title">üéØ Apprentissage cibl√©</ng-template>
        <p>Recherchez des mentors par comp√©tence et niveau.</p>
      </p-card>

      <p-card>
        <ng-template pTemplate="header">
          <img src="assets/img/calendar.png" alt="Disponibilit√©s flexibles" width="100" />
        </ng-template>
        <ng-template pTemplate="title">‚è∞ Disponibilit√©s flexibles</ng-template>
        <p>R√©servez des sessions quand √ßa vous arrange.</p>
      </p-card>

      <p-card>
        <ng-template pTemplate="header">
          <img src="assets/img/feedback.png" alt="Suivi & Feedback" width="100" />
        </ng-template>
        <ng-template pTemplate="title">üåü Suivi & Feedback</ng-template>
        <p>Laissez des avis, am√©liorez votre progression.</p>
      </p-card>
    </div>
  }

  @else {
    <div class="dashboard">
      <h2>üëã Bonjour {{ user()!.user.username }}</h2>

      @switch (dashboard()?.role) {

        @case ('STUDENT') {
          <div class="dashboard-grid">

            <p-card header="üìö Mes sessions">
              <p>
                Vous avez r√©serv√©
                <strong>{{ studentDashboard?.sessionsCount }}</strong> session(s).
              </p>
              <button
                pButton
                label="Voir mes sessions"
                icon="pi pi-calendar-plus"
                class="p-button-text p-button-sm"
              ></button>
            </p-card>

            <p-card header="üí¨ Feedbacks laiss√©s">
              <p>
                Vous avez partag√©
                <strong>{{ studentDashboard?.feedbacks }}</strong> avis.
              </p>
              <button
                pButton
                label="Voir mes feedbacks"
                icon="pi pi-comments"
                class="p-button-text p-button-sm"
              ></button>
            </p-card>

            <p-card header="‚≠ê Mentors recommand√©s">
              @if (hasRecommendedMentors()) {
                <ul>
                  @for (mentor of studentDashboard?.recommendedMentors ?? []; track mentor.id) {
                    <li>
                      <strong>{{ mentor.username }}</strong> ‚Äì {{ mentor.bio }} ({{ mentor.averageRating }}/5)
                    </li>
                  }
                </ul>
              }
              @else {
                <p>Aucun mentor recommand√© pour le moment.</p>
              }

              <button
                pButton
                label="Explorer les mentors"
                icon="pi pi-users"
                class="p-button-sm p-button-primary"
              ></button>
            </p-card>

          </div>
        }

        @case ('MENTOR') {
          <div class="dashboard-grid">

            <p-card header="üìÜ Mes disponibilit√©s">
              <p>
                Consultez vos sessions √† venir et g√©rez vos cr√©neaux directement dans le calendrier.
              </p>
              <a
                pButton
                icon="pi pi-calendar"
                label="Ouvrir le calendrier"
                class="p-button-sm p-button-success"
                [routerLink]="['/mentor/availabilities']"
              ></a>
            </p-card>

            <p-card header="‚≠ê Ma note moyenne">
              <p>
                Votre note actuelle est de
                <strong>{{ mentorDashboard?.averageRating }}/5</strong>.
              </p>
              <p-rating
                [ngModel]="mentorDashboard?.averageRating"
                [readonly]="true"
              ></p-rating>
            </p-card>

            <p-card header="üîî Notifications">
              <p>
                Vous avez
                <strong>{{ mentorDashboard?.notifications }}</strong> notification(s) en attente.
              </p>
              <button
                pButton
                label="Voir mes notifications"
                icon="pi pi-bell"
                class="p-button-sm p-button-warning"
              ></button>
            </p-card>

          </div>
        }

        @case ('ADMIN') {
          <div class="dashboard-grid">

            <p-card header="üë• Utilisateurs">
              <p>
                <strong>{{ adminDashboard?.usersCount }}</strong> comptes actifs.
              </p>
              <button
                pButton
                icon="pi pi-users"
                label="G√©rer les utilisateurs"
                class="p-button-sm p-button-primary"
              ></button>
            </p-card>

            <p-card header="üßë‚Äçüè´ Nouveaux mentors">
              <p>
                <strong>{{ adminDashboard?.newMentors }}</strong> cette semaine.
              </p>
              <button
                pButton
                icon="pi pi-user-plus"
                label="Voir les demandes"
                class="p-button-sm p-button-success"
              ></button>
            </p-card>

            <p-card header="üìà Sessions cette semaine">
              <p>
                <strong>{{ adminDashboard?.weeklySessions }}</strong> sessions organis√©es.
              </p>
              <button
                pButton
                icon="pi pi-chart-line"
                label="Statistiques"
                class="p-button-sm p-button-info"
              ></button>
            </p-card>

          </div>
        }
      }
    </div>
  }
</section>
